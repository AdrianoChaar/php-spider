#!/usr/bin/env bash

# Go to the root dir first, so configs and vendor dir is found
cd $(git rev-parse --show-toplevel)

echo -e "\nPHPLINT src/:"
find src/ -iname "*.php" -print0 | xargs -0 -n1 php -l 1>/dev/null || exit $?
echo -e "\nPHPLINT tests/:"
find tests/ -iname "*.php" -print0 | xargs -0 -n1 php -l 1>/dev/null || exit $?
echo -e "\nPHPUNIT:"
./vendor/bin/phpunit --stop-on-error --stop-on-failure --colors=auto || exit $?
echo -e "\nPHPCS src/:"
./vendor/bin/phpcs --warning-severity=0 --standard=PSR2 src/ || exit $?
echo -e "\nPHPCS tests/:"
./vendor/bin/phpcs --warning-severity=0 --standard=PSR2 tests/ || exit $?
echo -e "\nPHPMD src/:"
./vendor/bin/phpmd src/ text phpmd.xml || exit $?
echo -e "\nPHPMD tests/:"
./vendor/bin/phpmd tests/ text phpmd-tests.xml || exit $?
echo -e "\nPHPCPD src/:"
./vendor/bin/phpcpd --min-lines=7 --min-tokens=30  --fuzzy -v src/ || exit $?
echo -e "\nPHPCPD tests/:"
./vendor/bin/phpcpd --min-lines=7 --min-tokens=30  --fuzzy tests/ || exit $?


echo -e "\n\n All Done, no failures.\n"
